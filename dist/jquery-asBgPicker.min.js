/*! jQuery asBgPicker - v0.1.0 - 2014-03-07
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(e,s,t,i){"use strict";var a="asBgPicker",n=e[a]=function(s,t){var i={};this.element=s,this.$element=e(s),this.options=e.extend({},n.defaults,t,this.$element.data(),i),this.namespace=this.options.namespace,this.components=e.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1,this._trigger("init"),this.init()};n.prototype={constructor:n,components:{},init:function(){var s=this;s._createHtml(),this.options.skin&&this.$wrap.addClass(this.classes.skin),s._getVlue(),this.options.disabled&&this.disable(),s._setState(s.image),s._returnInfo(s.image),s.setImage(s.image),s.$repeatItem.removeClass(s.classes.active),e.each(s.repeatValue,function(e,t){s.$repeatItem.eq(e).data("repeat",t),s.repeat?s.repeat===t&&s.$repeatItem.eq(e).addClass(s.classes.active):s.$repeatItem.eq(1).addClass(s.classes.active)}),s.$positionItem.removeClass(s.classes.active),e.each(s.positionValue,function(e,t){s.$positionItem.eq(e).data("position",t),s.position?s.position===t&&s.$positionItem.eq(e).addClass(s.classes.active):s.$positionItem.eq(0).addClass(s.classes.active)}),s.$sizeItem.removeClass(s.classes.active),e.each(s.sizeValue,function(e,t){s.$sizeItem.eq(e).data("size",t),s.size?s.size===t&&s.$sizeItem.eq(e).addClass(s.classes.active):s.$sizeItem.eq(0).addClass(s.classes.active)});for(var t=0;s.attachmentValue.length>t;t++)s.attachmentValue[t]===s.attachment&&(s.select=t);s.$dropdown.dropdown({namespace:"az-dropdown",imitateSelect:!0,select:s.select,onChange:function(e){s.disabled||(s.attachment=e.attr("value"),s._process())}}),s._bindEvent(),s._process(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){var s=this;s.$bg_trigger.on("mouseenter",function(){s.disabled||(s.$bg_mask.addClass(s.classes.show),s.$bg_remove.addClass(s.classes.show))}).on("mouseleave",function(){s.disabled||(s.$bg_mask.removeClass(s.classes.show),s.$bg_remove.removeClass(s.classes.show))}),s.$bg_mask.on("click",function(){s.disabled||(s.$bg_trigger.addClass(s.classes.hide),s.$wrap.append(s.$extend),s.$extend.removeClass(s.classes.hide).addClass(s.classes.show))}),s.$bg_remove.on("click",function(){return s.disabled?i:(s.image="",s.repeat="",s.position="",s.attachment="",s.size="",s._setState(s.image),s._returnInfo(s.image),s._process(),!1)}),s.$bg_close.on("click",function(){return s.disabled?i:(s.$extend.removeClass(s.classes.show).addClass(s.classes.hide),s.$bg_trigger.removeClass(s.classes.hide),!1)}),s.$repeat.on("click","li",function(){if(!s.disabled){var t=e(this).data("repeat");if(s.repeat===t)return!1;if(s.repeat=t,e(this).hasClass(s.classes.active))return!1;s.$repeatItem.removeClass(s.classes.active),e(this).addClass(s.classes.active),s._process()}}),s.$position.on("click","li",function(){if(!s.disabled){var t=e(this).data("position");if(s.position===t)return!1;if(s.position=t,s.position=t,e(this).hasClass(s.classes.active))return!1;s.$positionItem.removeClass(s.classes.active),e(this).addClass(s.classes.active),s._process()}}),s.$size.on("click","li",function(){if(!s.disabled){var t=e(this).data("size");if(s.size===t)return!1;if(s.size=t,e(this).hasClass(s.classes.active))return!1;s.$sizeItem.removeClass(s.classes.active),e(this).addClass(s.classes.active),s._process()}}),s.$element.on("onChange",function(){s.disabled||s.options.onChange.call(s)}),s.$image.on("click",function(){s.disabled||s.options.onClickImage.call(s)})},_createHtml:function(){this.$wrap=e(this.options.tpl()),this.$extend=e(this.options.tpl_extend()),this.$element.after(this.$wrap),this.$bg_trigger=this.$wrap.find("."+this.namespace+"-trigger"),this.$bg_image=this.$bg_trigger.find("."+this.namespace+"-image-info"),this.$bg_remove=this.$wrap.find("."+this.namespace+"-remove"),this.$bg_mask=this.$wrap.find("."+this.namespace+"-mask"),this.$bg_close=this.$extend.find("."+this.namespace+"-close"),this.$image=this.$extend.find("."+this.namespace+"-image"),this.$repeat=this.$extend.find("."+this.namespace+"-repeat"),this.$position=this.$extend.find("."+this.namespace+"-position"),this.$attachment=this.$extend.find("."+this.namespace+"-attachment"),this.$size=this.$extend.find("."+this.namespace+"-size"),this.$dropdown=this.$extend.find("."+this.options.dropdown.namespace),this.$positionItem=this.$position.find("li"),this.$repeatItem=this.$repeat.find("li"),this.$sizeItem=this.$size.find("li")},_trigger:function(e){this.$element.trigger(a+"::"+e,this),e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});var s="on"+e,t=arguments.length>1?Array.prototype.slice.call(arguments,1):i;"function"==typeof this.options[s]&&this.options[s].apply(this,t)},_getVlue:function(){var e=this.$element.val();this.repeatValue=["no-repeat","repeat","repeat-x","repeat-y"],this.sizeValue=["auto","cover","contain","100% 100%"],this.attachmentValue=["scroll","fixed","inherit"],this.positionValue=["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],e?(this.value=jQuery.parseJSON(e),this.repeat=this.value.repeat,this.position=this.value.position,this.attachment=this.value.attachment,this.image=this.value.image,this.size=this.value.size):(this.repeat=this.options.repeat,this.position=this.options.position,this.attachment=this.options.attachment,this.image=this.options.image,this.size=this.options.size),this.image||(this.image=this.options.image)},_setState:function(e){var s=this;e&&e!==s.options.image?s.$bg_trigger.addClass(s.classes.hasImage):s.$bg_trigger.removeClass(s.classes.hasImage)},_returnInfo:function(s){var t,i=this;s&&s!==i.options.image?(t=s.match(/([\S]+[\/])([\S]+\w+$)/i)[2],e(i.$bg_image)[0].lastChild.nodeValue=t):e(i.$bg_image)[0].lastChild.nodeValue="Add Image"},_process:function(){this.value_current={},this.value_current.repeat=this.repeat,this.value_current.position=this.position,this.value_current.attachment=this.attachment,this.value_current.image=this.image,this.value_current.size=this.size,this.$element.val(JSON.stringify(this.value_current)),this.$image.css({"background-image":'url("'+this.image+'")',"background-repeat":this.repeat,"background-attachment":this.attachment,"background-position":this.position,"background-size":this.size})},setImage:function(e){var s,t=this;if(s=t.options.getThumbnalil(e),t._setState(e),t._returnInfo(e),e||e!==t.options.image){var i=new Image;i.onload=function(){t.image=s,t._returnInfo(t.image),t._process()},i.onerror=function(){t.image=e,t._returnInfo(t.image),t._process()},i.src=s}},setRepeat:function(e){this.repeat=e,this._process()},setSize:function(e){this.size=e,this._process()},setPosition:function(e){this.position=e,this._process()},setAttachment:function(e){this.attachment=e,this._process()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(a,null),this.$wrap.remove(),this._trigger("destory")}},n.defaults={namespace:a,repeat:"repeat",position:"top left",attachment:"scroll",size:"auto",image:"images/defaults.png",dropdown:{namespace:"az-dropdown"},tpl:function(){return'<div class="'+this.namespace+'">'+'<div class="'+this.namespace+'-trigger">'+'<div class="'+this.namespace+'-image-info"><span></span>Add Image</div>'+'<div class="'+this.namespace+'-mask">Change</div>'+'<a class="'+this.namespace+'-remove" href=""></a>'+"</div>"+"</div>"},tpl_extend:function(){return'<div class="'+this.namespace+'-extend">'+'<a class="'+this.namespace+'-close" href="#"></a>'+'<div class="'+this.namespace+'-image-wrap">'+'<div class="'+this.namespace+'-image"></div>'+"</div>"+'<div class="'+this.namespace+'-repeat">'+'<span class="'+this.namespace+'-repeat-title">Repeat</span>'+'<ul class="'+this.namespace+'-repeat-content">'+'<li class="repeat_no-repeat"></li>'+'<li class="repeat_repeat"></li>'+'<li class="repeat_repeat-x"></li>'+'<li class="repeat_repeat-y"></li>'+"</ul>"+"</div>"+'<div class="'+this.namespace+'-position">'+'<span class="'+this.namespace+'-position-title">Position</span>'+'<ul class="'+this.namespace+'-position-content">'+'<li class="postion_top-left"></li>'+'<li class="postion_top-center"></li>'+'<li class="postion_top-right"></li>'+'<li class="postion_center-left"></li>'+'<li class="postion_center-center"></li>'+'<li class="postion_center-right"></li>'+'<li class="postion_bottom-left"></li>'+'<li class="postion_bottom-center"></li>'+'<li class="postion_bottom-right"></li>'+"</ul>"+"</div>"+'<div class="'+this.namespace+'-attachment">'+'<span class="'+this.namespace+'-attachment-title">Attach</span>'+'<div class="'+this.namespace+'-attachment-content">'+'<div class="'+this.dropdown.namespace+" "+this.namespace+'-dropdown-trigger"><span></span></div>'+"<ul>"+'<li class="attachment_scroll" value="scroll">scroll</li>'+'<li class="attachment_fixed" value="fixed">fixed</li>'+'<li class="attachment_default" value="inherit">default</li>'+"</ul>"+"</div>"+"</div>"+'<div class="'+this.namespace+'-size">'+'<span class="'+this.namespace+'-size-title">Scalling</span>'+'<ul class="'+this.namespace+'-size-content">'+'<li class="size_adapt-height"></li>'+'<li class="size_adapt-width"></li>'+'<li class="size_adapt-all"></li>'+'<li class="size_adapt-auto"></li>'+"</ul>"+"</div>"+"</div>"},getThumbnalil:function(e){var s,t,i,a;return e?(s=e.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),t=s[1],a=s[2],i=s[3],t+"thumbnail-"+a+i):!1},onChange:function(){},onClickImage:function(){}},n.registerComponent=function(e,s){n.prototype.components[e]=s},e.fn[a]=function(s){if("string"!=typeof s)return this.each(function(){e.data(this,a)||e.data(this,a,new n(this,s))});var t=s,o=arguments.length>1?Array.prototype.slice.call(arguments,1):i;if(/^\_/.test(t))return!1;if(!(/^(getTabs)$/.test(t)||"val"===t&&o===i))return this.each(function(){var s=e.data(this,a);s&&"function"==typeof s[t]&&s[t].apply(s,o)});var c=this.first().data(a);return c&&"function"==typeof c[t]?c[t].apply(c,o):i}})(jQuery,document,window);