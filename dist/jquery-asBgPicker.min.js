/*! jQuery asBgPicker - v0.1.0 - 2014-03-10
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(e,t,s,i){"use strict";var a="asBgPicker",n=e[a]=function(t,s){var i={};this.element=t,this.$element=e(t),this.options=e.extend({},n.defaults,s,this.$element.data(),i),this.namespace=this.options.namespace,this.components=e.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1,this._trigger("init"),this.init()};n.prototype={constructor:n,components:{},init:function(){var e=this;e._createHtml(),this.options.skin&&this.$wrap.addClass(this.classes.skin),e._getVlue(),this.options.disabled&&this.disable(),e._initPosition(this.options.position),e._initRepeat(this.options.repeat),e._bindEvent(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){var e=this;e.$bg_trigger.on("mouseenter",function(){e.disabled||(e.$bg_mask.addClass(e.classes.show),e.$bg_remove.addClass(e.classes.show))}).on("mouseleave",function(){e.disabled||(e.$bg_mask.removeClass(e.classes.show),e.$bg_remove.removeClass(e.classes.show))}),e.$bg_mask.on("click",function(){e.disabled||(e.$bg_trigger.addClass(e.classes.hide),e.$wrap.append(e.$extend),e.$extend.removeClass(e.classes.hide).addClass(e.classes.show))}),e._repeatEvent(),e._positionEvent(),e.$bg_close.on("click",function(){return e.disabled?i:(e.$extend.removeClass(e.classes.show).addClass(e.classes.hide),e.$bg_trigger.removeClass(e.classes.hide),!1)}),e.$element.on("onChange",function(){e.disabled||e.options.onChange.call(e)})},_createHtml:function(){this.$wrap=e(this.options.tpl()),this.$extend=e(this.options.tpl_extend()),this.$element.after(this.$wrap),this.$bg_trigger=this.$wrap.find("."+this.namespace+"-trigger"),this.$bg_image=this.$bg_trigger.find("."+this.namespace+"-image-info"),this.$bg_remove=this.$wrap.find("."+this.namespace+"-remove"),this.$bg_mask=this.$wrap.find("."+this.namespace+"-mask"),this.$bg_close=this.$extend.find("."+this.namespace+"-close")},_trigger:function(e){this.$element.trigger(a+"::"+e,this),e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});var t="on"+e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):i;"function"==typeof this.options[t]&&this.options[t].apply(this,s)},_getVlue:function(){var e=this.$element.val();return this.repeatValue=this.options.repeat.values,this.positionValue=this.options.position.values,e?(this.value=jQuery.parseJSON(e),i):!1},_setState:function(e){var t=this;e&&e!==t.options.image?t.$bg_trigger.addClass(t.classes.hasImage):t.$bg_trigger.removeClass(t.classes.hasImage)},_returnInfo:function(t){var s,i=this;t&&t!==i.options.image?(s=t.match(/([\S]+[\/])([\S]+\w+$)/i)[2],e(i.$bg_image)[0].lastChild.nodeValue=s):e(i.$bg_image)[0].lastChild.nodeValue="Add Image"},_process:function(){this.value_current={},this.value_current.repeat=this.repeat,this.value_current.position=this.position,this.$element.val(JSON.stringify(this.value_current))},_initRepeat:function(t){console.log(t,"repeat-options");var s=this;s.repeat=s.value?s.value.repeat:t.default_value;var i=t.tpl().replace(/namespace/g,s.namespace);s.$tpl_repeat=e(i),s.$bg_close.after(s.$tpl_repeat),s.$repeat=s.$extend.find("."+s.namespace+"-repeat"),s.$repeatItem=s.$repeat.find("li"),e.each(s.repeatValue,function(e,t){s.$repeatItem.eq(e).data("repeat",t),s.repeat?s.repeat===t&&s.$repeatItem.eq(e).addClass(s.classes.active):s.$repeatItem.removeClass(s.classes.active)})},_repeatEvent:function(){var t=this;t.$repeat.on("click","li",function(){if(!t.disabled){var s=e(this).data("repeat");if(t.repeat===s)return!1;if(t.repeat=s,e(this).hasClass(t.classes.active))return!1;t.$repeatItem.removeClass(t.classes.active),e(this).addClass(t.classes.active),t._process()}})},_initPosition:function(t){console.log(t,"position-options");var s=this;s.position=s.value?s.value.position:t.default_value;var i=t.tpl().replace(/namespace/g,s.namespace);s.$tpl_position=e(i),s.$bg_close.after(s.$tpl_position),s.$position=s.$extend.find("."+s.namespace+"-position"),s.$positionItem=s.$position.find("li"),e.each(s.positionValue,function(e,t){s.$positionItem.eq(e).data("position",t),s.position?s.position===t&&s.$positionItem.eq(e).addClass(s.classes.active):s.$positionItem.removeClass(s.classes.active)})},_positionEvent:function(){var t=this;t.$position.on("click","li",function(){if(!t.disabled){var s=e(this).data("position");if(t.position===s)return!1;if(t.position=s,e(this).hasClass(t.classes.active))return!1;t.$positionItem.removeClass(t.classes.active),e(this).addClass(t.classes.active),t._process()}})},val:function(e){},set:function(){}},n.defaults={namespace:a,dropdown:{namespace:"az-dropdown"},repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="namespace-repeat"><span class="namespace-repeat-title">Repeat</span><ul class="namespace-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="namespace-position"><span class="namespace-position-title">Position</span><ul class="namespace-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},tpl:function(){return'<div class="'+this.namespace+'">'+'<div class="'+this.namespace+'-trigger">'+'<div class="'+this.namespace+'-image-info"><span></span>Add Image</div>'+'<div class="'+this.namespace+'-mask">Change</div>'+'<a class="'+this.namespace+'-remove" href=""></a>'+"</div>"+"</div>"},tpl_extend:function(){return'<div class="'+this.namespace+'-extend">'+'<a class="'+this.namespace+'-close" href="#"></a>'+"</div>"},onChange:function(){},onClickImage:function(){}},n.registerComponent=function(e,t){n.prototype.components[e]=t},e.fn[a]=function(t){if("string"!=typeof t)return this.each(function(){e.data(this,a)||e.data(this,a,new n(this,t))});var s=t,o=arguments.length>1?Array.prototype.slice.call(arguments,1):i;if(/^\_/.test(s))return!1;if(!(/^(getTabs)$/.test(s)||"val"===s&&o===i))return this.each(function(){var t=e.data(this,a);t&&"function"==typeof t[s]&&t[s].apply(t,o)});var l=this.first().data(a);return l&&"function"==typeof l[s]?l[s].apply(l,o):i}})(jQuery,document,window);