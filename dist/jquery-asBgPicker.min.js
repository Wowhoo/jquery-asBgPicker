/*! jQuery asBgPicker - v0.1.0 - 2014-03-13
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(e,t,a,s){"use strict";var i="asBgPicker",n=e[i]=function(t,a){var o={};this.element=t,this.$element=e(t),this.options=e.extend({},n.defaults,a,this.$element.data(),o),this.namespace=this.options.namespace,this.components=e.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1;var l=this;e.extend(l,{init:function(){l._createHtml(),l.options.skin&&l.$wrap.addClass(l.classes.skin),l._getValue(),l.options.disabled&&l.disable(),l._setState(l.image),l._returnInfo(l.image),l.setImage(l.image),l.doSize.init(),l.doAttachment.init(),l.doPosition.init(),l.doRepeat.init(),l._bindEvent(),l.val(l.value,!0),l.initialed=!0,l._trigger("ready")},_bindEvent:function(){l.$bg_trigger.on("mouseenter",function(){l.disabled||(l.$bg_mask.addClass(l.classes.show),l.$bg_remove.addClass(l.classes.show))}).on("mouseleave",function(){l.disabled||(l.$bg_mask.removeClass(l.classes.show),l.$bg_remove.removeClass(l.classes.show))}),l.$bg_mask.on("click",function(){l.disabled||(l.$bg_trigger.addClass(l.classes.hide),l.$wrap.append(l.$extend),l.$extend.removeClass(l.classes.hide).addClass(l.classes.show))}),l.doRepeat.bindEvent(),l.doPosition.bindEvent(),l.doSize.bindEvent(),l.doAttachment.bindEvent(),l.$bg_remove.on("click",function(){return l.disabled?s:(l.clear(),!1)}),l.$bg_close.on("click",function(){return l.disabled?s:(l.$extend.removeClass(l.classes.show).addClass(l.classes.hide),l.$bg_trigger.removeClass(l.classes.hide),!1)}),l.$element.on("onChange",function(){l.disabled||l.options.onChange.call(l)}),l.$image.on("click",function(){l.disabled||l.options.onClickImage.call(l)})},_createHtml:function(){l.$wrap=e(l.options.tpl()),l.$extend=e(l.options.tpl_extend()),l.$element.after(l.$wrap),l.$bg_trigger=l.$wrap.find("."+l.namespace+"-trigger"),l.$bg_image=l.$bg_trigger.find("."+l.namespace+"-image-info"),l.$bg_remove=l.$wrap.find("."+l.namespace+"-remove"),l.$bg_mask=l.$wrap.find("."+l.namespace+"-mask"),l.$bg_close=l.$extend.find("."+l.namespace+"-close"),l.$image=l.$extend.find("."+l.namespace+"-image"),l.$image_wrap=l.$extend.find("."+l.namespace+"-image-wrap")},_trigger:function(e){l.$element.trigger(i+"::"+e,l),e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});var t="on"+e,a=arguments.length>1?Array.prototype.slice.call(arguments,1):s;"function"==typeof l.options[t]&&l.options[t].apply(l,a)},_getValue:function(){var e=l.$element.val();return l.repeatValue=l.options.repeat.values,l.positionValue=l.options.position.values,l.sizeValue=l.options.size.values,l.attachmentValue=l.options.attachment.values,e?(l.value=l.options.parse(e),l.image=l.value.image,l.image||(l.image=l.options.image),s):!1},_setState:function(e){e&&e!==l.options.image?l.$bg_trigger.addClass(l.classes.hasImage):l.$bg_trigger.removeClass(l.classes.hasImage)},_returnInfo:function(t){var a;t&&t!==l.options.image?(a=t.match(/([\S]+[\/])([\S]+\w+$)/i)[2],e(l.$bg_image)[0].lastChild.nodeValue=a):e(l.$bg_image)[0].lastChild.nodeValue="Add Image"},_process:function(){null===l.value&&(l.value={}),l.value.repeat=l.repeat,l.value.position=l.position,l.value.attachment=l.attachment,l.value.image=l.image,l.value.size=l.size,l.$element.val(l.options.process(l.value)),l.$image.css({"background-image":'url("'+l.image+'")',"background-repeat":l.repeat,"background-attachment":l.attachment,"background-position":l.position,"background-size":l.size})},doRepeat:{init:function(){l.repeat=l.value?l.value.repeat:l.options.repeat.default_value;var t=l.options.repeat.tpl().replace(/namespace/g,l.namespace);l.$tpl_repeat=e(t),l.$image_wrap.after(l.$tpl_repeat),l.$repeat=l.$extend.find("."+l.namespace+"-repeat"),l.$repeatItem=l.$repeat.find("li"),l.doRepeat.setup(l.repeat)},setup:function(t){l.$repeatItem.removeClass(l.classes.active),e.each(l.repeatValue,function(e,a){return l.$repeatItem.eq(e).data("repeat",a),t?(t===a&&l.$repeatItem.eq(e).addClass(l.classes.active),s):!1})},bindEvent:function(){l.$repeat.on("click","li",function(){if(!l.disabled){var t=e(this).data("repeat");if(l.repeat===t)return!1;if(l.repeat=t,e(this).hasClass(l.classes.active))return!1;l.$repeatItem.removeClass(l.classes.active),e(this).addClass(l.classes.active),l._process()}})}},doPosition:{init:function(){l.position=l.value?l.value.position:l.options.position.default_value;var t=l.options.position.tpl().replace(/namespace/g,l.namespace);l.$tpl_position=e(t),l.$image_wrap.after(l.$tpl_position),l.$position=l.$extend.find("."+l.namespace+"-position"),l.$positionItem=l.$position.find("li"),l.doPosition.setup(l.position)},setup:function(t){l.$positionItem.removeClass(l.classes.active),e.each(l.positionValue,function(e,a){return l.$positionItem.eq(e).data("position",a),t?(t===a&&l.$positionItem.eq(e).addClass(l.classes.active),s):!1})},bindEvent:function(){l.$position.on("click","li",function(){if(!l.disabled){var t=e(this).data("position");if(l.position===t)return!1;if(l.position=t,e(this).hasClass(l.classes.active))return!1;l.$positionItem.removeClass(l.classes.active),e(this).addClass(l.classes.active),l._process()}})}},doSize:{init:function(){l.size=l.value?l.value.size:l.options.size.default_value;var t=l.options.size.tpl().replace(/namespace/g,l.namespace);l.$tpl_size=e(t),l.$image_wrap.after(l.$tpl_size),l.$size=l.$extend.find("."+l.namespace+"-size"),l.$sizeItem=l.$size.find("li"),l.doSize.setup(l.size)},setup:function(t){l.$sizeItem.removeClass(l.classes.active),e.each(l.sizeValue,function(e,a){return l.$sizeItem.eq(e).data("size",a),t?(t===a&&l.$sizeItem.eq(e).addClass(l.classes.active),s):!1})},bindEvent:function(){l.$size.on("click","li",function(){if(!l.disabled){var t=e(this).data("size");if(l.size===t)return!1;if(l.size=t,e(this).hasClass(l.classes.active))return!1;l.$sizeItem.removeClass(l.classes.active),e(this).addClass(l.classes.active),l._process()}})}},doAttachment:{init:function(){l.attachment=l.value?l.value.attachment:l.options.attachment.default_value;var t=l.options.attachment.tpl().replace(/otherNamespace/g,l.options.attachment.namespace).replace(/namespace/g,l.namespace);l.$tpl_attachment=e(t),l.$image_wrap.after(l.$tpl_attachment),l.$attachment=l.$extend.find("."+l.namespace+"-attachment"),l.$attachmentItem=l.$attachment.find("li"),l.$dropdown=l.$extend.find("."+l.options.attachment.namespace),l.doAttachment.setup(l.attachment)},setup:function(e){l.select=2;for(var t=0;l.attachmentValue.length>t;t++)l.attachmentValue[t]===e&&(l.select=t)},bindEvent:function(){l.$dropdown.dropdown({namespace:l.options.attachment.namespace,imitateSelect:!0,select:l.select,onChange:function(e){l.disabled||(l.attachment=e.attr("value"),l._process())}})}}}),this._trigger("init"),this.init()};n.prototype={constructor:n,components:{},val:function(e,t){return e===s?this.value:(e?this.set(e,t):this.clear(t),s)},set:function(e,t){var a=this;t!==!1&&(a.value=e,a.image=e.image,a.repeat=e.repeat,a.size=e.size,a.position=e.position,a.attachment=e.attachment,a.doRepeat.setup(e.repeat),a.doSize.setup(e.size),a.doPosition.setup(e.position),a.doAttachment.setup(e.attachment),a._process(),a.options.onChange.call(a,e))},clear:function(e){var t=this;t.value=null,e!==!1&&(t.image="",t.repeat="",t.position="",t.attachment="",t.size="",t._setState(t.image),t._returnInfo(t.image),t.doRepeat.setup(t.repeat),t.doSize.setup(t.size),t.doPosition.setup(t.position),t.doAttachment.setup(t.attachment),t._process(),t.options.onChange.call(t,t.value))},setImage:function(e){var t,a=this;if(t=a.options.getThumbnalil(e),a._setState(e),a._returnInfo(e),e||e!==a.options.image){var s=new Image;s.onload=function(){a.image=t,a._returnInfo(a.image),a._process()},s.onerror=function(){a.image=e,a._returnInfo(a.image),a._process()},s.src=t}},setRepeat:function(e){this.repeat=e,this.doRepeat.setup(e),this._process()},setSize:function(e){this.size=e,this.doSize.setup(e),this._process()},setPosition:function(e){this.position=e,this.doPosition.setup(e),this._process()},setAttachment:function(e){this.attachment=e,this.doAttachment.setup(e),this._process()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(i,null),this.$wrap.remove(),this._trigger("destory")}},n.defaults={namespace:i,skin:null,image:"images/defaults.png",repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="namespace-repeat"><span class="namespace-repeat-title">Repeat</span><ul class="namespace-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="namespace-position"><span class="namespace-position-title">Position</span><ul class="namespace-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},size:{default_value:"auto",values:["auto","cover","contain","100% 100%"],tpl:function(){return'<div class="namespace-size"><span class="namespace-size-title">Scalling</span><ul class="namespace-size-content"><li class="size_adapt-height"></li><li class="size_adapt-width"></li><li class="size_adapt-all"></li><li class="size_adapt-auto"></li></ul></div>'}},attachment:{namespace:"az-dropdown",default_value:"scroll",values:["scroll","fixed","inherit"],tpl:function(){return'<div class="namespace-attachment"><span class="namespace-attachment-title">Attach</span><div class="namespace-attachment-content"><div class="otherNamespace namespace-dropdown-trigger"><span></span></div><ul><li class="attachment_scroll" value="scroll">scroll</li><li class="attachment_fixed" value="fixed">fixed</li><li class="attachment_default" value="inherit">default</li></ul></div></div>'}},tpl:function(){return'<div class="'+this.namespace+'">'+'<div class="'+this.namespace+'-trigger">'+'<div class="'+this.namespace+'-image-info"><span></span>Add Image</div>'+'<div class="'+this.namespace+'-mask">Change</div>'+'<a class="'+this.namespace+'-remove" href=""></a>'+"</div>"+"</div>"},tpl_extend:function(){return'<div class="'+this.namespace+'-extend">'+'<a class="'+this.namespace+'-close" href="#"></a>'+'<div class="'+this.namespace+'-image-wrap">'+'<div class="'+this.namespace+'-image"></div>'+"</div>"+"</div>"},process:function(e){return e?JSON.stringify(e):""},parse:function(t){return t?e.parseJSON(t):null},getThumbnalil:function(e){var t,a,s,i;return e?(t=e.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),a=t[1],i=t[2],s=t[3],a+"thumbnail-"+i+s):!1},onChange:function(){},onClickImage:function(){}},n.registerComponent=function(e,t){n.prototype.components[e]=t},e.fn[i]=function(t){if("string"!=typeof t)return this.each(function(){e.data(this,i)||e.data(this,i,new n(this,t))});var a=t,o=arguments.length>1?Array.prototype.slice.call(arguments,1):s;if(/^\_/.test(a))return!1;if(!(/^(getTabs)$/.test(a)||"val"===a&&o===s))return this.each(function(){var t=e.data(this,i);t&&"function"==typeof t[a]&&t[a].apply(t,o)});var l=this.first().data(i);return l&&"function"==typeof l[a]?l[a].apply(l,o):s}})(jQuery,document,window);