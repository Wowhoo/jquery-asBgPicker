/*! jQuery asBgPicker - v0.1.0 - 2014-03-11
* https://github.com/amazingSurge/jquery-asBgPicker
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(e,t,s,a){"use strict";var i="asBgPicker",n=e[i]=function(t,s){var a={};this.element=t,this.$element=e(t),this.options=e.extend({},n.defaults,s,this.$element.data(),a),this.namespace=this.options.namespace,this.components=e.extend(!0,{},this.components),this.classes={skin:this.namespace+"_"+this.options.skin,disabled:this.namespace+"_disabled",active:this.namespace+"_active",hide:this.namespace+"_hide",show:this.namespace+"_show",hasImage:this.namespace+"_hasImage"},this.disabled=!1,this.initialed=!1,this._trigger("init"),this.init()};n.prototype={constructor:n,components:{},init:function(){var e=this;e._createHtml(),this.options.skin&&this.$wrap.addClass(this.classes.skin),e._getValue(),this.options.disabled&&this.disable(),e._setState(e.image),e._returnInfo(e.image),e.setImage(e.image),e._initSize(this.options.size),e._initAttachment(this.options.attachment),e._initPosition(this.options.position),e._initRepeat(this.options.repeat),e._bindEvent(),e._process(),this.initialed=!0,this._trigger("ready")},_bindEvent:function(){var e=this;e.$bg_trigger.on("mouseenter",function(){e.disabled||(e.$bg_mask.addClass(e.classes.show),e.$bg_remove.addClass(e.classes.show))}).on("mouseleave",function(){e.disabled||(e.$bg_mask.removeClass(e.classes.show),e.$bg_remove.removeClass(e.classes.show))}),e.$bg_mask.on("click",function(){e.disabled||(e.$bg_trigger.addClass(e.classes.hide),e.$wrap.append(e.$extend),e.$extend.removeClass(e.classes.hide).addClass(e.classes.show))}),e._repeatEvent(),e._positionEvent(),e._sizeEvent(),e._attachmentEvent(),e.$bg_remove.on("click",function(){return e.disabled?a:(e.image="",e.repeat="",e.position="",e.attachment="",e.size="",e._setState(e.image),e._returnInfo(e.image),e._process(),!1)}),e.$bg_close.on("click",function(){return e.disabled?a:(e.$extend.removeClass(e.classes.show).addClass(e.classes.hide),e.$bg_trigger.removeClass(e.classes.hide),!1)}),e.$element.on("onChange",function(){e.disabled||e.options.onChange.call(e)}),e.$image.on("click",function(){e.disabled||e.options.onClickImage.call(e)})},_createHtml:function(){this.$wrap=e(this.options.tpl()),this.$extend=e(this.options.tpl_extend()),this.$element.after(this.$wrap),this.$bg_trigger=this.$wrap.find("."+this.namespace+"-trigger"),this.$bg_image=this.$bg_trigger.find("."+this.namespace+"-image-info"),this.$bg_remove=this.$wrap.find("."+this.namespace+"-remove"),this.$bg_mask=this.$wrap.find("."+this.namespace+"-mask"),this.$bg_close=this.$extend.find("."+this.namespace+"-close"),this.$image=this.$extend.find("."+this.namespace+"-image"),this.$image_wrap=this.$extend.find("."+this.namespace+"-image-wrap")},_trigger:function(e){this.$element.trigger(i+"::"+e,this),e=e.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)});var t="on"+e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):a;"function"==typeof this.options[t]&&this.options[t].apply(this,s)},_getValue:function(){var e=this.$element.val();return this.repeatValue=this.options.repeat.values,this.positionValue=this.options.position.values,this.sizeValue=this.options.size.values,this.attachmentValue=this.options.attachment.values,e?(this.value=this._parseValue(e),this.image=this.value.image,this.image||(this.image=this.options.image),a):!1},_parseValue:function(e){return jQuery.parseJSON(e)},_setState:function(e){var t=this;e&&e!==t.options.image?t.$bg_trigger.addClass(t.classes.hasImage):t.$bg_trigger.removeClass(t.classes.hasImage)},_returnInfo:function(t){var s,a=this;t&&t!==a.options.image?(s=t.match(/([\S]+[\/])([\S]+\w+$)/i)[2],e(a.$bg_image)[0].lastChild.nodeValue=s):e(a.$bg_image)[0].lastChild.nodeValue="Add Image"},_process:function(){this.value_current={},this.value_current.repeat=this.repeat,this.value_current.position=this.position,this.value_current.attachment=this.attachment,this.value_current.image=this.image,this.value_current.size=this.size,this.$element.val(JSON.stringify(this.value_current)),this.$image.css({"background-image":'url("'+this.image+'")',"background-repeat":this.repeat,"background-attachment":this.attachment,"background-position":this.position,"background-size":this.size})},_initRepeat:function(t){console.log(t,"repeat-options");var s=this;s.repeat=s.value?s.value.repeat:t.default_value;var a=t.tpl().replace(/namespace/g,s.namespace);s.$tpl_repeat=e(a),s.$image_wrap.after(s.$tpl_repeat),s.$repeat=s.$extend.find("."+s.namespace+"-repeat"),s.$repeatItem=s.$repeat.find("li"),e.each(s.repeatValue,function(e,t){s.$repeatItem.eq(e).data("repeat",t),s.repeat?s.repeat===t&&s.$repeatItem.eq(e).addClass(s.classes.active):s.$repeatItem.removeClass(s.classes.active)})},_repeatEvent:function(){var t=this;t.$repeat.on("click","li",function(){if(!t.disabled){var s=e(this).data("repeat");if(t.repeat===s)return!1;if(t.repeat=s,e(this).hasClass(t.classes.active))return!1;t.$repeatItem.removeClass(t.classes.active),e(this).addClass(t.classes.active),t._process()}})},_initPosition:function(t){console.log(t,"position-options");var s=this;s.position=s.value?s.value.position:t.default_value;var a=t.tpl().replace(/namespace/g,s.namespace);s.$tpl_position=e(a),s.$image_wrap.after(s.$tpl_position),s.$position=s.$extend.find("."+s.namespace+"-position"),s.$positionItem=s.$position.find("li"),e.each(s.positionValue,function(e,t){s.$positionItem.eq(e).data("position",t),s.position?s.position===t&&s.$positionItem.eq(e).addClass(s.classes.active):s.$positionItem.removeClass(s.classes.active)})},_positionEvent:function(){var t=this;t.$position.on("click","li",function(){if(!t.disabled){var s=e(this).data("position");if(t.position===s)return!1;if(t.position=s,e(this).hasClass(t.classes.active))return!1;t.$positionItem.removeClass(t.classes.active),e(this).addClass(t.classes.active),t._process()}})},_initSize:function(t){console.log(t,"size-options");var s=this;s.size=s.value?s.value.size:t.default_value;var a=t.tpl().replace(/namespace/g,s.namespace);s.$tpl_size=e(a),s.$image_wrap.after(s.$tpl_size),s.$size=s.$extend.find("."+s.namespace+"-size"),s.$sizeItem=s.$size.find("li"),e.each(s.sizeValue,function(e,t){s.$sizeItem.eq(e).data("size",t),s.size?s.size===t&&s.$sizeItem.eq(e).addClass(s.classes.active):s.$sizeItem.removeClass(s.classes.active)})},_sizeEvent:function(){var t=this;t.$size.on("click","li",function(){if(!t.disabled){var s=e(this).data("size");if(t.size===s)return!1;if(t.size=s,e(this).hasClass(t.classes.active))return!1;t.$sizeItem.removeClass(t.classes.active),e(this).addClass(t.classes.active),t._process()}})},_initAttachment:function(t){console.log(t,"attachment-options");var s=this;s.attachment=s.value?s.value.attachment:t.default_value;var a=t.tpl().replace(/otherNamespace/g,t.namespace).replace(/namespace/g,s.namespace);s.$tpl_attachment=e(a),s.$image_wrap.after(s.$tpl_attachment),s.$attachment=s.$extend.find("."+s.namespace+"-attachment"),s.$attachmentItem=s.$attachment.find("li"),s.$dropdown=s.$extend.find("."+t.namespace);for(var i=0;s.attachmentValue.length>i;i++)s.attachmentValue[i]===s.attachment&&(s.select=i)},_attachmentEvent:function(){var e=this;e.$dropdown.dropdown({namespace:e.options.attachment.namespace,imitateSelect:!0,select:e.select,onChange:function(t){e.disabled||(e.attachment=t.attr("value"),e._process())}})},val:function(e,t){return e===a?this.value:(e?this.set(e,t):this.clear(t),a)},set:function(e,t){var s=this;s.value=e,t!==!1&&(s.options.onChange.call(s,e),s.$element.val(JSON.stringify(e)))},clear:function(e){this.value=null,self.image="",self.repeat="",self.position="",self.attachment="",self.size="",self._process(),e!==!1&&this.options.onChange.call(this,this.value)},setImage:function(e){var t,s=this;if(t=s.options.getThumbnalil(e),s._setState(e),s._returnInfo(e),e||e!==s.options.image){var a=new Image;a.onload=function(){s.image=t,s._returnInfo(s.image),s._process()},a.onerror=function(){s.image=e,s._returnInfo(s.image),s._process()},a.src=t}},setRepeat:function(e){this.repeat=e,this._process()},setSize:function(e){this.size=e,this._process()},setPosition:function(e){this.position=e,this._process()},setAttachment:function(e){this.attachment=e,this._process()},enable:function(){this.disabled=!1,this.$wrap.removeClass(this.classes.disabled)},disable:function(){this.disabled=!0,this.$wrap.addClass(this.classes.disabled)},destory:function(){this.$element.data(i,null),this.$wrap.remove(),this._trigger("destory")}},n.defaults={namespace:i,skin:null,image:"images/defaults.png",repeat:{default_value:"repeat",values:["no-repeat","repeat","repeat-x","repeat-y"],tpl:function(){return'<div class="namespace-repeat"><span class="namespace-repeat-title">Repeat</span><ul class="namespace-repeat-content"><li class="repeat_no-repeat"></li><li class="repeat_repeat"></li><li class="repeat_repeat-x"></li><li class="repeat_repeat-y"></li></ul></div>'}},position:{default_value:"top left",values:["top left","top center","top right","center left","center center","center right","bottom left","bottom center","bottom right"],tpl:function(){return'<div class="namespace-position"><span class="namespace-position-title">Position</span><ul class="namespace-position-content"><li class="postion_top-left"></li><li class="postion_top-center"></li><li class="postion_top-right"></li><li class="postion_center-left"></li><li class="postion_center-center"></li><li class="postion_center-right"></li><li class="postion_bottom-left"></li><li class="postion_bottom-center"></li><li class="postion_bottom-right"></li></ul></div>'}},size:{default_value:"auto",values:["auto","cover","contain","100% 100%"],tpl:function(){return'<div class="namespace-size"><span class="namespace-size-title">Scalling</span><ul class="namespace-size-content"><li class="size_adapt-height"></li><li class="size_adapt-width"></li><li class="size_adapt-all"></li><li class="size_adapt-auto"></li></ul></div>'}},attachment:{namespace:"az-dropdown",default_value:"scroll",values:["scroll","fixed","inherit"],tpl:function(){return'<div class="namespace-attachment"><span class="namespace-attachment-title">Attach</span><div class="namespace-attachment-content"><div class="otherNamespace namespace-dropdown-trigger"><span></span></div><ul><li class="attachment_scroll" value="scroll">scroll</li><li class="attachment_fixed" value="fixed">fixed</li><li class="attachment_default" value="inherit">default</li></ul></div></div>'}},tpl:function(){return'<div class="'+this.namespace+'">'+'<div class="'+this.namespace+'-trigger">'+'<div class="'+this.namespace+'-image-info"><span></span>Add Image</div>'+'<div class="'+this.namespace+'-mask">Change</div>'+'<a class="'+this.namespace+'-remove" href=""></a>'+"</div>"+"</div>"},tpl_extend:function(){return'<div class="'+this.namespace+'-extend">'+'<a class="'+this.namespace+'-close" href="#"></a>'+'<div class="'+this.namespace+'-image-wrap">'+'<div class="'+this.namespace+'-image"></div>'+"</div>"+"</div>"},getThumbnalil:function(e){var t,s,a,i;return e?(t=e.match(/([\S]+[\/])([\S]+)(\.+\w+$)/i),s=t[1],i=t[2],a=t[3],s+"thumbnail-"+i+a):!1},onChange:function(){},onClickImage:function(){}},n.registerComponent=function(e,t){n.prototype.components[e]=t},e.fn[i]=function(t){if("string"!=typeof t)return this.each(function(){e.data(this,i)||e.data(this,i,new n(this,t))});var s=t,o=arguments.length>1?Array.prototype.slice.call(arguments,1):a;if(/^\_/.test(s))return!1;if(!(/^(getTabs)$/.test(s)||"val"===s&&o===a))return this.each(function(){var t=e.data(this,i);t&&"function"==typeof t[s]&&t[s].apply(t,o)});var l=this.first().data(i);return l&&"function"==typeof l[s]?l[s].apply(l,o):a}})(jQuery,document,window);